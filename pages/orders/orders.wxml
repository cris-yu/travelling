<!-- pages/orders/orders.wxml -->
<view class="container">
  <view wx:if="{{orders.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— è¡Œç¨‹è®°å½•</text>
    <button class="go-home-btn" bind:tap="goToHome">
      å»çœ‹çœ‹æ—…æ¸¸äº§å“
    </button>
  </view>

  <view wx:else class="orders-container">
    <view wx:for="{{orders}}" wx:key="id" wx:for-item="order" wx:for-index="idx" class="order-card">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-title">{{order.productTitle}}</view>
        <view class="order-status" style="color: #52c41a;">å·²ç¡®è®¤</view>
      </view>

      <!-- å…³é”®ä¿¡æ¯çªå‡ºæ˜¾ç¤º -->
      <view class="order-highlights">
        <view class="highlight-item urgent">
          <view class="highlight-label">é›†åˆæ—¶é—´</view>
          <view class="highlight-value time">{{order.meetingTime}}</view>
        </view>
        
        <view class="highlight-item urgent">
          <view class="highlight-label">é›†åˆåœ°ç‚¹</view>
          <view class="highlight-value location">{{order.meetingPoint}}</view>
          <button class="action-btn map-btn" bind:tap="openNavigation" 
                  data-latitude="{{order.latitude}}" 
                  data-longitude="{{order.longitude}}" 
                  data-address="{{order.meetingPoint}}">
            ğŸ“ å¯¼èˆª
          </button>
        </view>

        <view class="highlight-item">
          <view class="highlight-label">å¯¼æ¸¸ç”µè¯</view>
          <view class="highlight-value phone">{{order.guidePhone}}</view>
          <button class="action-btn call-btn" bind:tap="callGuide" data-phone="{{order.guidePhone}}">
            ğŸ“ æ‹¨æ‰“
          </button>
        </view>

        <view class="highlight-item">
          <view class="highlight-label">å¯¼æ¸¸å§“å</view>
          <view class="highlight-value">{{order.guideName}}</view>
        </view>
      </view>

      <!-- ç´§æ€¥è”ç³»äººä¿¡æ¯ -->
      <view wx:if="{{order.emergencyContact}}" class="emergency-contact-section">
        <view class="emergency-title">ğŸš¨ ç´§æ€¥è”ç³»äºº</view>
        <view class="emergency-info">
          <view class="emergency-row">
            <text class="emergency-label">å§“åï¼š</text>
            <text class="emergency-value">{{order.emergencyContact.name}}</text>
          </view>
          <view class="emergency-row">
            <text class="emergency-label">ç”µè¯ï¼š</text>
            <text class="emergency-value phone">{{order.emergencyContact.phone}}</text>
            <button class="emergency-call-btn" bind:tap="callEmergency" 
                    data-phone="{{order.emergencyContact.phone}}">
              ğŸ“ ä¸€é”®æ‹¨æ‰“
            </button>
          </view>
        </view>
      </view>

      <!-- è®¢å•è¯¦æƒ… -->
      <view class="order-details">
        <view class="detail-row">
          <text class="detail-label">è®¢å•ç¼–å·</text>
          <text class="detail-value">{{order.id}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å‡ºè¡Œæ—¥æœŸ</text>
          <text class="detail-value">{{order.travelDate}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">é¢„è®¢æ—¥æœŸ</text>
          <text class="detail-value">{{order.bookingDate}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">è®¢å•é‡‘é¢</text>
          <text class="detail-value price">Â¥{{order.totalPrice}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="order-actions">
        <button class="action-button outline" bind:tap="viewItinerary" data-id="{{order.id}}">
          æŸ¥çœ‹è¯¦ç»†è¡Œç¨‹
        </button>
        <button class="action-button primary" bind:tap="shareItinerary" data-index="{{idx}}">
          åˆ†äº«ç»™å®¶äºº
        </button>
      </view>
    </view>
  </view>

  <!-- å®¢æœç»„ä»¶ -->
  <customer-service />
</view>
